{"remainingRequest":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/src/pages/Playsong.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/src/pages/Playsong.vue","mtime":1621833335582},{"path":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/node_modules/cache-loader/dist/cjs.js","mtime":1619416685351},{"path":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/node_modules/babel-loader/lib/index.js","mtime":1620626789420},{"path":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/node_modules/cache-loader/dist/cjs.js","mtime":1619416685351},{"path":"/home/lxy/Projects/UniversityExperiments/MobileAppsDev/Experiment5/vue-music/Music-play-front/node_modules/vue-loader/lib/index.js","mtime":1621232596899}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgU3dpcGVyIGZyb20gInN3aXBlciI7ICAgLy/mmK/nm67liY3lupTnlKjovoPlub/ms5vnmoTnp7vliqjnq6/nvZHpobXop6bmkbjlhoXlrrnmu5Hliqhqc+aPkuS7tixodHRwczovL3d3dy5zd2lwZXIuY29tLmNuLw0KaW1wb3J0IFJlY29tbWVuZCBmcm9tICIuLi9jb21wb25lbnRzL1JlY29tbWVuZC52dWUiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGx5cmljSW5kZXg6IDANCiAgICB9Ow0KICB9LA0KICBjb21wb25lbnRzOiB7DQogICAgUmVjb21tZW5kDQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgc29uZ0RBVEEoKSB7DQogICAgICBjb25zdCB7IGN1ciwgbGlzdCB9ID0gdGhpcy4kc3RvcmUuc3RhdGU7DQogICAgICByZXR1cm4gKA0KICAgICAgICBsaXN0LmZpbmQoaXRlbSA9PiB7DQogICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGl0ZW0uaWQpID09PSBjdXI7DQogICAgICAgIH0pIHx8IG51bGwNCiAgICAgICk7DQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJxdWVyeURhdGFBIiwgdGhpcy4kcm91dGUucGFyYW1zLmlkKTsNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICAkcm91dGUodG8pIHsNCiAgICAgIHRoaXMuYXVkaW9Db21wbGV0ZSgpOw0KICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goInF1ZXJ5RGF0YUEiLCB0by5wYXJhbXMuaWQpOw0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmluaXRTd2lwZXIoKTsNCiAgICB0aGlzLmF1ZGlvSGFuZGxlKCk7DQogIH0sDQogIHVwZGF0ZWQoKSB7DQogICAgdGhpcy5pbml0U3dpcGVyKCk7DQogICAgdGhpcy5hdWRpb0hhbmRsZSgpOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLy8g5Yid5aeL5YyWU1dJUEVSDQogICAgaW5pdFN3aXBlcigpIHsNCiAgICAgIGlmICghdGhpcy5zb25nREFUQSkgcmV0dXJuOw0KICAgICAgaWYgKHRoaXMuJHN3aXBlcikgew0KICAgICAgICB0aGlzLiRzd2lwZXIudXBkYXRlU2xpZGVzKCk7DQogICAgICAgIHRoaXMuJHN3aXBlci51cGRhdGVTaXplKCk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHRoaXMuJHN3aXBlciA9IG5ldyBTd2lwZXIodGhpcy4kcmVmcy5seXJpYywgew0KICAgICAgICBkaXJlY3Rpb246ICJ2ZXJ0aWNhbCIsDQogICAgICAgIHNsaWRlc1BlclZpZXc6ICJhdXRvIg0KICAgICAgfSk7DQogICAgfSwNCiAgICAvLyDot7PovazliLBNVg0KICAgIG9wZW5WaWRlbyhpZCkgew0KICAgICAgdGhpcy4kcm91dGVyLnB1c2goYC9wbGF5dmlkZW8vJHtpZH1gKTsNCiAgICB9LA0KICAgIC8vIOaOp+WItumfs+S5kOeahOaSreaUvuWSjOaaguWBnA0KICAgIGF1ZGlvUGxheSgpIHsNCiAgICAgIGxldCB7IGF1ZGlvLCBhdWRpb0J0biB9ID0gdGhpcy4kcmVmczsNCiAgICAgIGlmICghYXVkaW8pIHJldHVybjsNCiAgICAgIGF1ZGlvLnBsYXkoKTsNCiAgICAgIGF1ZGlvQnRuLmNsYXNzTmFtZSA9ICJ6YW50aW5nIjsNCiAgICAgIHRoaXMubHlyaWNBdXRvKCk7DQogICAgfSwNCiAgICBhdWRpb1BhdXNlKCkgew0KICAgICAgbGV0IHsgYXVkaW8sIGF1ZGlvQnRuIH0gPSB0aGlzLiRyZWZzOw0KICAgICAgaWYgKCFhdWRpbykgcmV0dXJuOw0KICAgICAgYXVkaW8ucGF1c2UoKTsNCiAgICAgIGF1ZGlvQnRuLmNsYXNzTmFtZSA9ICIiOw0KICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5seXJpY1RpbWVyKTsNCiAgICB9LA0KICAgIGF1ZGlvQ29tcGxldGUoKSB7DQogICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLmx5cmljVGltZXIpOw0KICAgICAgdGhpcy5seXJpY0luZGV4ID0gMDsNCiAgICAgIHRoaXMuJHN3aXBlci5zbGlkZVRvKDAsIDApOw0KICAgIH0sDQogICAgYXVkaW9IYW5kbGUoKSB7DQogICAgICAvLyDmjqfliLbpn7PkuZDnmoToh6rliqjmkq3mlL4NCiAgICAgIGxldCBwbGF5ID0gKCkgPT4gew0KICAgICAgICB0aGlzLmF1ZGlvUGxheSgpOw0KICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwgcGxheSk7DQogICAgICB9Ow0KICAgICAgcGxheSgpOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiV2VpeGluSlNCcmlkZ2VSZWFkeSIsIHBsYXkpOw0KICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIHBsYXkpOw0KDQogICAgICAvLyDngrnlh7vmjInpkq7mjqfliLbmmoLlgZzmiJbogIXnu6fnu63mkq3mlL4NCiAgICAgIGxldCB7IGF1ZGlvLCBhdWRpb0J0biB9ID0gdGhpcy4kcmVmczsNCiAgICAgIGlmICghYXVkaW8pIHJldHVybjsNCiAgICAgIGF1ZGlvQnRuLm9uY2xpY2sgPSAoKSA9PiB7DQogICAgICAgIGlmIChhdWRpby5wYXVzZWQpIHsNCiAgICAgICAgICB0aGlzLmF1ZGlvUGxheSgpOw0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmF1ZGlvUGF1c2UoKTsNCiAgICAgIH07DQogICAgfSwNCiAgICBseXJpY0F1dG8oKSB7DQogICAgICBsZXQgeyBhdWRpbyB9ID0gdGhpcy4kcmVmczsNCiAgICAgIGlmICghYXVkaW8pIHJldHVybjsNCiAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMubHlyaWNUaW1lcik7DQogICAgICB0aGlzLmx5cmljVGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICBsZXQgZHVyYXRpb24gPSBhdWRpby5kdXJhdGlvbiwNCiAgICAgICAgICBjdXJyZW50VGltZSA9IGF1ZGlvLmN1cnJlbnRUaW1lOw0KICAgICAgICBpZiAoY3VycmVudFRpbWUgPj0gZHVyYXRpb24pIHsNCiAgICAgICAgICB0aGlzLmF1ZGlvQ29tcGxldGUoKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgLy8g5q2M6K+N5a+55bqU5ZKM6Lef552A5YqoDQogICAgICAgIGlmICghdGhpcy5zb25nREFUQSkgcmV0dXJuOw0KICAgICAgICBsZXQgbjsNCiAgICAgICAgdGhpcy5zb25nREFUQS5seXJpYy5maW5kKChpdGVtLCBpbmRleCkgPT4gew0KICAgICAgICAgIGxldCB7IG1pbnV0ZXMsIHNlY29uZHMgfSA9IGl0ZW07DQogICAgICAgICAgaWYgKG1pbnV0ZXMgKiA2MCArIHBhcnNlSW50KHNlY29uZHMpID09PSBNYXRoLnJvdW5kKGN1cnJlbnRUaW1lKSkgew0KICAgICAgICAgICAgbiA9IGluZGV4Ow0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChuICYmIG4gIT09IHRoaXMubHlyaWNJbmRleCkgew0KICAgICAgICAgIHRoaXMubHlyaWNJbmRleCA9IG47DQogICAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5seXJpY0luZGV4IC0gMzsNCiAgICAgICAgICBpbmRleCA8IDAgPyAoaW5kZXggPSAwKSA6IG51bGw7DQogICAgICAgICAgdGhpcy4kc3dpcGVyLnNsaWRlVG8oaW5kZXgsIDIwMCk7DQogICAgICAgIH0NCiAgICAgIH0sIDEwMDApOw0KICAgIH0NCiAgfQ0KfTsNCg=="},{"version":3,"sources":["Playsong.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Playsong.vue","sourceRoot":"src/pages","sourcesContent":["<template>\r\n  <div class=\"playBox\" v-if=\"songDATA\">\r\n    <div class=\"bg\">\r\n      <img :src=\"songDATA.pic\" alt />\r\n    </div>\r\n\r\n    <div class=\"content\">\r\n      <div class=\"header\">\r\n        <h2 v-text=\"songDATA.title\"></h2>\r\n        <p v-text=\"songDATA.author\"></p>\r\n      </div>\r\n      <div class=\"lyric swiper-container\" ref=\"lyric\">\r\n        <div class=\"wrapper swiper-wrapper\">\r\n          <p\r\n            v-for=\"(item,index) in songDATA.lyric\"\r\n            v-text=\"item.content\"\r\n            :key=\"index\"\r\n            :class=\"`swiper-slide ${lyricIndex===index?'active':''}`\"\r\n          ></p>\r\n        </div>\r\n      </div>\r\n      <div class=\"handle\">\r\n        <i @click=\"openVideo(songDATA.id)\"></i>\r\n        <i ref=\"audioBtn\"></i>\r\n        <i></i>\r\n      </div>\r\n    </div>\r\n\r\n    <audio :src=\"songDATA.music\" style=\"display:none\" ref=\"audio\"></audio>\r\n\r\n    <!-- 热门推荐 -->\r\n    <recommend></recommend>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Swiper from \"swiper\";   //是目前应用较广泛的移动端网页触摸内容滑动js插件,https://www.swiper.com.cn/\r\nimport Recommend from \"../components/Recommend.vue\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      lyricIndex: 0\r\n    };\r\n  },\r\n  components: {\r\n    Recommend\r\n  },\r\n  computed: {\r\n    songDATA() {\r\n      const { cur, list } = this.$store.state;\r\n      return (\r\n        list.find(item => {\r\n          return parseInt(item.id) === cur;\r\n        }) || null\r\n      );\r\n    }\r\n  },\r\n  created() {\r\n    this.$store.dispatch(\"queryDataA\", this.$route.params.id);\r\n  },\r\n  watch: {\r\n    $route(to) {\r\n      this.audioComplete();\r\n      this.$store.dispatch(\"queryDataA\", to.params.id);\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initSwiper();\r\n    this.audioHandle();\r\n  },\r\n  updated() {\r\n    this.initSwiper();\r\n    this.audioHandle();\r\n  },\r\n  methods: {\r\n    // 初始化SWIPER\r\n    initSwiper() {\r\n      if (!this.songDATA) return;\r\n      if (this.$swiper) {\r\n        this.$swiper.updateSlides();\r\n        this.$swiper.updateSize();\r\n        return;\r\n      }\r\n      this.$swiper = new Swiper(this.$refs.lyric, {\r\n        direction: \"vertical\",\r\n        slidesPerView: \"auto\"\r\n      });\r\n    },\r\n    // 跳转到MV\r\n    openVideo(id) {\r\n      this.$router.push(`/playvideo/${id}`);\r\n    },\r\n    // 控制音乐的播放和暂停\r\n    audioPlay() {\r\n      let { audio, audioBtn } = this.$refs;\r\n      if (!audio) return;\r\n      audio.play();\r\n      audioBtn.className = \"zanting\";\r\n      this.lyricAuto();\r\n    },\r\n    audioPause() {\r\n      let { audio, audioBtn } = this.$refs;\r\n      if (!audio) return;\r\n      audio.pause();\r\n      audioBtn.className = \"\";\r\n      window.clearInterval(this.lyricTimer);\r\n    },\r\n    audioComplete() {\r\n      window.clearInterval(this.lyricTimer);\r\n      this.lyricIndex = 0;\r\n      this.$swiper.slideTo(0, 0);\r\n    },\r\n    audioHandle() {\r\n      // 控制音乐的自动播放\r\n      let play = () => {\r\n        this.audioPlay();\r\n        document.removeEventListener(\"touchstart\", play);\r\n      };\r\n      play();\r\n      document.addEventListener(\"WeixinJSBridgeReady\", play);\r\n      document.addEventListener(\"touchstart\", play);\r\n\r\n      // 点击按钮控制暂停或者继续播放\r\n      let { audio, audioBtn } = this.$refs;\r\n      if (!audio) return;\r\n      audioBtn.onclick = () => {\r\n        if (audio.paused) {\r\n          this.audioPlay();\r\n          return;\r\n        }\r\n        this.audioPause();\r\n      };\r\n    },\r\n    lyricAuto() {\r\n      let { audio } = this.$refs;\r\n      if (!audio) return;\r\n      window.clearInterval(this.lyricTimer);\r\n      this.lyricTimer = window.setInterval(() => {\r\n        let duration = audio.duration,\r\n          currentTime = audio.currentTime;\r\n        if (currentTime >= duration) {\r\n          this.audioComplete();\r\n          return;\r\n        }\r\n        // 歌词对应和跟着动\r\n        if (!this.songDATA) return;\r\n        let n;\r\n        this.songDATA.lyric.find((item, index) => {\r\n          let { minutes, seconds } = item;\r\n          if (minutes * 60 + parseInt(seconds) === Math.round(currentTime)) {\r\n            n = index;\r\n            return true;\r\n          }\r\n          return false;\r\n        });\r\n        if (n && n !== this.lyricIndex) {\r\n          this.lyricIndex = n;\r\n          let index = this.lyricIndex - 3;\r\n          index < 0 ? (index = 0) : null;\r\n          this.$swiper.slideTo(index, 200);\r\n        }\r\n      }, 1000);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.playBox {\r\n  position: relative;\r\n  padding-top: 0.4rem;\r\n\r\n  .content {\r\n    padding: 0 0.4rem;\r\n    .header {\r\n      text-align: center;\r\n      h2 {\r\n        line-height: 0.56rem;\r\n        font-size: 0.38rem;\r\n        font-weight: normal;\r\n      }\r\n      p {\r\n        line-height: 0.44rem;\r\n        font-size: 0.32rem;\r\n        color: grey;\r\n      }\r\n    }\r\n\r\n    .lyric {\r\n      margin-top: 0.2rem;\r\n      height: 4.9rem;\r\n      text-align: center;\r\n      overflow: hidden;\r\n\r\n      p {\r\n        height: 0.6rem !important;\r\n        line-height: 0.6rem;\r\n        color: rgba(0, 0, 0, 0.7);\r\n        font-size: 0.3rem;\r\n        text-overflow: ellipsis;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        transition: 0.2s;\r\n\r\n        &.active {\r\n          color: #2293d5;\r\n        }\r\n      }\r\n    }\r\n\r\n    .handle {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      height: 1.5rem;\r\n\r\n      i {\r\n        margin: 0 0.3rem;\r\n        width: 0.8rem;\r\n        height: 0.8rem;\r\n        border: 0.02rem solid rgba(0, 0, 0, 0.2);\r\n        border-radius: 50%;\r\n\r\n        &:nth-child(1) {\r\n          background: url(\"../assets/images/ttpodicon.svg\") no-repeat center\r\n            center;\r\n          background-size: 0.6rem 0.6rem;\r\n        }\r\n\r\n        &:nth-child(3) {\r\n          background: url(\"../assets/images/shoucang.svg\") no-repeat 50% 52%;\r\n          background-size: 0.35rem 0.35rem;\r\n        }\r\n\r\n        &:nth-child(2) {\r\n          background: url(\"../assets/images/bofang.svg\") no-repeat 58% center;\r\n          background-size: 0.45rem 0.45rem;\r\n\r\n          &.zanting {\r\n            background: url(\"../assets/images/zanting.svg\") no-repeat center\r\n              center;\r\n            background-size: 0.45rem 0.45rem;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .bg {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    z-index: -1;\r\n    width: 100%;\r\n    img {\r\n      display: block;\r\n      width: 100%;\r\n      opacity: 0.04;\r\n    }\r\n  }\r\n}\r\n</style>"]}]}